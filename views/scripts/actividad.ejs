<script>
	$(document).ready(function () {
	    var summary = null;
	    var entity = "<%=entity%>";

		var monthlyLabels = [
	        <% for (var i = 0; i < casos.length; i++) {
	            if (i != casos.length -1) { %>
	                "<%= casos[i].month %>/<%= casos[i].year %>",
	            <% }
	               else { %>
	                "<%= casos[i].month %>/<%= casos[i].year %>"
	            <% }
	            }
	        %>
	    ];

		console.log(monthlyLabels);

		function displaySummaryFor(caso) {
            console.log("caso", caso)
            var post_count = [];
            var comment_count = [];
            var angry = [];
            var like = [];
            var haha = [];
            var sad = [];
            var love = [];
            var wow = [];

            for (var i = 0; i < summary.length; i++) {
                for (var j = 0; j < summary[i][entity].length; j++) {
                    if (summary[i][entity][j].short_name == caso) {
                        post_count.push(summary[i][entity][j].post_count);
                        comment_count.push(summary[i][entity][j].comment_count);
                        angry.push(summary[i][entity][j].angry);
                        like.push(summary[i][entity][j].like);
                        haha.push(summary[i][entity][j].haha);
                        sad.push(summary[i][entity][j].sad);
                        love.push(summary[i][entity][j].love);
                        wow.push(summary[i][entity][j].wow);
                        break;
                    }
                }
            }

            configActividad.data.datasets[0].data = post_count;
            configActividad.data.datasets[1].data = comment_count;
            configReactions.data.datasets[0].data = like;
            configReactions.data.datasets[1].data = angry;
            configReactions.data.datasets[2].data = haha;
            configReactions.data.datasets[3].data = sad;
            configReactions.data.datasets[4].data = love;
            configReactions.data.datasets[5].data = wow;


            window.activity.update();
            window.reactions.update();
        }

        var labelPublicaciones = "";
        var labelComentarios = "";
        if (entity == "lideres") {
        	labelPublicaciones = "Cantidad de publicaciones sobre el líder";
        	labelComentarios = "Cantidad de comentarios sobre el líder";
        }
        else if (entity == "casos") {
        	labelPublicaciones = "Cantidad de publicaciones sobre el caso";
        	labelComentarios = "Cantidad de comentarios sobre el caso";
        }



        var configActividad = {
            type: 'line',
            data: {
                // TODO: poner años programatically
                /*labels: ["Enero/16", "Febrero/16", "Marzo/16", "Abril/16", "Mayo/16", "Junio/16", "Julio/16", "Agosto/16", "Septiembre/16", "Octubre/16", "Noviembre/16", "Diciembre/16", "Enero/17", "Febrero/17", "Marzo/17", "Abril/17", "Mayo/17", "Junio/17", "Julio/17", "Agosto/17", "Septiembre/17", "Octubre/17", "Noviembre/17", "Diciembre/17"],*/
                labels: monthlyLabels,
                datasets: [{
                    label: labelPublicaciones,
                    lineTension: 0,
                    backgroundColor: window.chartColors.green,
                    borderColor: window.chartColors.green,
                    data: [
                    ],
                    fill: false
                },
                {
                    label: labelComentarios,
                    lineTension: 0,
                    backgroundColor: window.chartColors.blue_like,
                    borderColor: window.chartColors.blue_like,
                    data: [
                    ],
                    fill: false
                }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                title:{
                    display:true,
                    text:'Actividad'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Tiempo'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Valor'
                        }
                    }]
                }
            }
        };

        var activityCtx = document.getElementById("activity").getContext("2d");
        window.activity = new Chart(activityCtx, configActividad);

        var configReactions = {
	        type: 'line',
	        data: {
	            // TODO: poner años programatically
	            labels: monthlyLabels,
	            datasets: [
	            {
	                label: "Me gusta",
	                lineTension: 0,
	                backgroundColor: window.chartColors.blue_like,
	                borderColor: window.chartColors.blue_like,
	                data: [
	                ],
	                fill: false
	            },
	            {
	                label: "Me enfada",
	                lineTension: 0,
	                backgroundColor: window.chartColors.red,
	                borderColor: window.chartColors.red,
	                data: [
	                ],
	                fill: false
	            },
	            {
	                label: "Me divierte",
	                lineTension: 0,
	                backgroundColor: window.chartColors.happy,
	                borderColor: window.chartColors.happy,
	                data: [
	                ],
	                fill: false
	            },
	            {
	                label: "Me entristece",
	                lineTension: 0,
	                backgroundColor: window.chartColors.sad,
	                borderColor: window.chartColors.sad,
	                data: [
	                ],
	                fill: false
	            },
	            {
	                label: "Me encanta",
	                lineTension: 0,
	                backgroundColor: window.chartColors.love,
	                borderColor: window.chartColors.love,
	                data: [
	                ],
	                fill: false
	            },
	            {
	                label: "Me asombra",
	                lineTension: 0,
	                backgroundColor: window.chartColors.surprise,
	                borderColor: window.chartColors.surprise,
	                data: [
	                ],
	                fill: false
	            }
	            ]
	        },
	        options: {
	            responsive: true,
	            maintainAspectRatio: false,
	            title:{
	                display:true,
	                text:'Reacciones'
	            },
	            tooltips: {
	                mode: 'index',
	                intersect: false,
	            },
	            hover: {
	                mode: 'nearest',
	                intersect: true
	            },
	            scales: {
	                xAxes: [{
	                    display: true,
	                    scaleLabel: {
	                        display: true,
	                        labelString: 'Tiempo'
	                    }
	                }],
	                yAxes: [{
	                    display: true,
	                    scaleLabel: {
	                        display: true,
	                        labelString: 'Valor'
	                    }
	                }]
	            }
	        }
	    };

	    var reactionsCtx = document.getElementById("reactions").getContext("2d");
	    window.reactions = new Chart(reactionsCtx, configReactions);

        $.get("/summary/activity/<%=entity%>", function (data) {
	        summary = data;
	        console.log("DATA IS",data);
	        displaySummaryFor("<%=displayDefault%>");
	    });

	    $(".dropdown-menu > li > a").on('click', {}, function (evt) {
            var entity = $(this).attr('id');
            displaySummaryFor(entity);
	    });
	});
</script>