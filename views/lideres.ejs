<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon.png" />
    <!-- TODO: cambiar favicon -->
    <link rel="icon" type="image/png" href="/favicon.ico" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Sentinel</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <!-- Bootstrap core CSS     -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <!--  Material Dashboard CSS    -->
    <link href="/css/material-dashboard.css?v=1.2.0" rel="stylesheet" />
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/css/demo.css" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons' rel='stylesheet' type='text/css'>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-color="purple" data-image="/img/sidebar-1.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="logo">
                <a href="#" class="simple-text">
                    Sentinel
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li>
                        <a href="/descubre">
                            <i class="material-icons">bubble_chart</i>
                            <p>Descubre</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="/lideres">
                            <i class="material-icons">group</i>
                            <p>Líderes</p>
                        </a>
                    </li>
                    <li>
                        <a href="/instituciones">
                            <i class="material-icons">business</i>
                            <p>Instituciones</p>
                        </a>
                    </li>
                    <li>
                        <a href="/casos">
                            <i class="material-icons">gavel</i>
                            <p>Casos de corrupción</p>
                        </a>
                    </li>
                    <li>
                        <a href="/medios">
                            <i class="material-icons">web</i>
                            <p>Medios</p>
                        </a>
                    </li>
                    <li class="active-pro">
                        <a href="#">
                            <i class="material-icons">info</i>
                            <p>Aviso legal</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <nav class="navbar navbar-transparent navbar-absolute">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <!-- TODO: cambiar titulo -->
                        <a class="navbar-brand" href="#"> Material Dashboard </a>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                        <!--
                            <li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">dashboard</i>
                                    <p class="hidden-lg hidden-md">Dashboard</p>
                                </a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">notifications</i>
                                    <span class="notification">5</span>
                                    <p class="hidden-lg hidden-md">Notifications</p>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#">Mike John responded to your email</a>
                                    </li>
                                    <li>
                                        <a href="#">You have 5 new tasks</a>
                                    </li>
                                    <li>
                                        <a href="#">You're now friend with Andrew</a>
                                    </li>
                                    <li>
                                        <a href="#">Another Notification</a>
                                    </li>
                                    <li>
                                        <a href="#">Another One</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="#pablo" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="material-icons">person</i>
                                    <p class="hidden-lg hidden-md">Profile</p>
                                </a>
                            </li>
                        -->
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-3 dropdown">
                            <a id="dropdown-title" href="#" class="btn dropdown-toggle" data-toggle="dropdown">
                                <!-- TODO: reemplazar por el primero en orden alfabetico (con ejs) -->
                                <% if (lideres.length > 0) { %>
                                <%= lideres[0].name %>
                                <% } %>
                                <b class="caret"></b>
                            </a>
                            <ul id="lideres" class="dropdown-menu">
                                <% if (lideres.length > 0) { %>
                                <% lideres.forEach(function (lider) { %>
                                    <li><a id="<%= lider.id %>" href="#"><%= lider.name %></a></li>
                                <% }) %>
                                <% } %>
                                <!--
                                <li class="divider"></li>
                                <li><a href="#">Separated link</a></li>
                                <li class="divider"></li>
                                <li><a href="#">One more separated link</a></li>
                                -->
                            </ul>
                        </div>

                    </div>
                    <div class="row">
                        <!-- Line chart -->
                        <div class="col-lg-12">
                            <canvas id="myChart" width="100%" height="400"></canvas>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-12">
                            <div class="card">
                                <div class="card-header" data-background-color="orange">

                                    <h4 class="title">Comentarios populares sobre <span id="comment-lider"><% if (lideres.length > 0) { %><%= lideres[0].name %><% } %></span> este mes</h4>
                                    <p class="category"></p>
                                </div>
                                <div class="card-content table-responsive">
                                    <table class="table table-hover">
                                        <thead class="text-warning">
                                            <th>No.</th>
                                            <th>Mensaje</th>
                                            <th>Likes</th>
                                        </thead>
                                        <tbody id="top-comments">
                                            <% if (summary.length > 0) {
                                                for (var i = 0; i < summary[summary.length - 1].top_comments.length; i++) { %>
                                                    <tr>
                                                        <td><%= (i+1) %></td>
                                                        <td><%= summary[summary.length - 1].top_comments[i] %></td>
                                                        <td><%= summary[summary.length - 1].like_counts[i] %></td>
                                                    </tr>
                                            <% } %>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul>
                            <li>
                                <a href="#">
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Company
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Portfolio
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Blog
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <p class="copyright pull-right">
                        &copy;
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                        Sentinel
                    </p>
                </div>
            </footer>
        </div>
    </div>
</body>
<!--   Core JS Files   -->
<script src="/js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/js/material.min.js" type="text/javascript"></script>
<!--  Charts Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.min.js"></script>
<script src="/js/chartist.min.js"></script>
<script src="/js/utils.js"></script>
<!--  Dynamic Elements plugin -->
<script src="/js/arrive.min.js"></script>
<!--  PerfectScrollbar Library -->
<script src="/js/perfect-scrollbar.jquery.min.js"></script>
<!--  Notifications Plugin    -->
<script src="/js/bootstrap-notify.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!-- Material Dashboard javascript methods -->
<script src="/js/material-dashboard.js?v=1.2.0"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="/js/demo.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        var monthlyLabels = [
            <% for (var i = 0; i < summary.length; i++) {
                if (i != summary.length -1) { %>
                    "<%= summary[i].month %>/<%= summary[i].year %>",
                <% }
                   else { %>
                    "<%= summary[i].month %>/<%= summary[i].year %>"
                <% }
                }
            %>
        ];
        // Javascript method's body can be found in assets/js/demos.js
        demo.initDashboardPageCharts();
        /*
            TODO: total de likes que tiene la pagina del lider (en caso de que tenga pagina de fb)
            TODO: total de reacciones que ha recibido en su pagina el lider (todos los posts del lider) - en caso de que tenga página
            TODO: de cuales temas habla más el lider en su pagina (en caso de que tenga pagina)
            TODO: grafico de cantidad de posts sobre el personaje que se esta viendo (en los medios)
            TODO: actividad del lider (cuantas publicaciones ha hecho en su pagina) - en caso de que tenga pagina
            TODO: palabras que se suelen mencionar en publicaciones de este personaje (nada mas es buscar en el graph)
            TODO: Palabras mas mencionadas (word cloud) en los comentarios sobre publicaciones de un personaje especifico (ej: cuando se publica de Uribe, los comentarios suelen contener las palabras)
        */
        var config = {
            type: 'line',
            data: {
                // TODO: poner años programatically
                /*labels: ["Enero/16", "Febrero/16", "Marzo/16", "Abril/16", "Mayo/16", "Junio/16", "Julio/16", "Agosto/16", "Septiembre/16", "Octubre/16", "Noviembre/16", "Diciembre/16", "Enero/17", "Febrero/17", "Marzo/17", "Abril/17", "Mayo/17", "Junio/17", "Julio/17", "Agosto/17", "Septiembre/17", "Octubre/17", "Noviembre/17", "Diciembre/17"],*/
                labels: monthlyLabels,
                datasets: [{
                    label: "Sentimientos negativos",
                    lineTension: 0,
                    backgroundColor: window.chartColors.red,
                    borderColor: window.chartColors.red,
                    data: [
                        <% for (var i = 0; i < summary.length; i++) {
                            if (i != summary.length -1) { %>
                                "<%= summary[i].negative %>",
                            <% }
                               else { %>
                                "<%= summary[i].negative %>"
                            <% }
                            }
                        %>
                    ],
                    fill: false,
                }, {
                    label: "Sentimientos positivos",
                    lineTension: 0,
                    fill: false,
                    backgroundColor: window.chartColors.green,
                    borderColor: window.chartColors.green,
                    data: [
                        <% for (var i = 0; i < summary.length; i++) {
                            if (i != summary.length -1) { %>
                                "<%= summary[i].positive %>",
                            <% }
                               else { %>
                                "<%= summary[i].positive %>"
                            <% }
                            }
                        %>
                    ],
                }, {
                    label: "Sentimientos neutros",
                    hidden: true,
                    lineTension: 0,
                    fill: false,
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.blue,
                    data: [
                        <% for (var i = 0; i < summary.length; i++) {
                            if (i != summary.length -1) { %>
                                "<%= summary[i].neutral %>",
                            <% }
                               else { %>
                                "<%= summary[i].neutral %>"
                            <% }
                            }
                        %>
                    ],
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                title:{
                    display:true,
                    text:'Comentarios'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Tiempo'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Valor'
                        }
                    }]
                }
            }
        };

        var ctx = document.getElementById("myChart").getContext("2d");
        window.myLine = new Chart(ctx, config);

        $("#lideres > li > a").on('click', function (evt) {
            console.log("clicked")
            var entity = $(this).attr('id');
            var seleccionado = $(this).text();
            $("#comment-lider").html(seleccionado);
            console.log("Seleccionado", seleccionado)
            
            $.get("/summary/comments/" + entity, function (data) {
                // Negative
                var negative = []
                for (var i = 0; i < data.length; i++) {
                    negative.push(data[i].negative);
                }
                config.data.datasets[0].data = negative;
                // Positive
                var positive = []
                for (var i = 0; i < data.length; i++) {
                    positive.push(data[i].positive);
                }
                config.data.datasets[1].data = positive;
                // Neutral
                var neutral = []
                for (var i = 0; i < data.length; i++) {
                    neutral.push(data[i].neutral);
                }
                config.data.datasets[2].data = neutral;
                
                config.data.labels = [];
                for (var i = 0; i < data.length; i++) {
                    config.data.labels.push(data[i].month+ "/" + data[i].year)
                }

                console.log(data);

                /*config.data.datasets.forEach(function(dataset) {
                    dataset.data = dataset.data.map(function() {
                        return randomScalingFactor();
                    });
                });*/

                window.myLine.update();
                //var replaceStr = '<tbody id="top-comments">';
                var replaceStr = '';
                if (data.length > 0) {
                    console.log("data.length > 0");
                    for (var i = 0; i < data[data.length - 1].top_comments.length; i++) {
                        replaceStr += "<tr>";
                        replaceStr += "<td>" + (i+1) + "</td>";
                        replaceStr += "<td>" + data[data.length - 1].top_comments[i] + "</td>";
                        replaceStr += "<td>" + data[data.length - 1].like_counts[i] + "</td>";
                        replaceStr += "</tr>";
                    }
                }
                $("#top-comments").html(replaceStr);
                
            });

            // TODO: traer los datos de la persona que fue clicked

            var lider = $(this).text();
            $("#dropdown-title").text(lider + " ");
            $("#dropdown-title").append('<b class="caret"></b>');
        });

    });
</script>
<script src="/js/lideres.js"></script>
</html>